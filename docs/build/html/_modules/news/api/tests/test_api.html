

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>news.api.tests.test_api &mdash; Project name not set  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Project name not set
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules.html">news</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Project name not set</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">news.api.tests.test_api</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for news.api.tests.test_api</h1><div class="highlight"><pre>
<span></span>
<span class="kn">from</span><span class="w"> </span><span class="nn">unittest.mock</span><span class="w"> </span><span class="kn">import</span> <span class="n">patch</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">django.test</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">Client</span><span class="p">,</span> <span class="n">override_settings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_user_model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Group</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">mail</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span> <span class="n">parse_qs</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.test</span><span class="w"> </span><span class="kn">import</span> <span class="n">APITestCase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.authtoken.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Token</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">news.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Publisher</span><span class="p">,</span> <span class="n">Article</span><span class="p">,</span> <span class="n">CustomUser</span><span class="p">,</span> <span class="n">Newsletter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">news.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">SubscriptionForm</span><span class="p">,</span> <span class="n">CustomUserCreationForm</span><span class="p">,</span> <span class="n">ArticleForm</span>

<span class="n">User</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span>


<span class="c1"># ─── API TESTS ───────────────────────────────────────────────────────────────</span>


<div class="viewcode-block" id="NewsApiTests">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">NewsApiTests</span><span class="p">(</span><span class="n">APITestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for token auth and all /api/ endpoints.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="NewsApiTests.setUpTestData">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests.setUpTestData">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setUpTestData</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># Avoid duplicate errors using get_or_create</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">reader_group</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Reader&quot;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">journalist_group</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Journalist&quot;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">editor_group</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Editor&quot;</span><span class="p">)</span>

        <span class="c1"># Users</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s2">&quot;reader1&quot;</span><span class="p">,</span> <span class="s2">&quot;r1@x.com&quot;</span><span class="p">,</span> <span class="s2">&quot;pass1234&quot;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">reader_group</span><span class="p">)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">journalist</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s2">&quot;journalist1&quot;</span><span class="p">,</span> <span class="s2">&quot;j1@x.com&quot;</span><span class="p">,</span> <span class="s2">&quot;pass1234&quot;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">journalist</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">journalist_group</span><span class="p">)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s2">&quot;editor1&quot;</span><span class="p">,</span> <span class="s2">&quot;e1@x.com&quot;</span><span class="p">,</span> <span class="s2">&quot;pass1234&quot;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">editor_group</span><span class="p">)</span>

        <span class="c1"># Publisher &amp; Articles</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">publisher</span> <span class="o">=</span> <span class="n">Publisher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Daily News&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Daily News Publisher&quot;</span>
        <span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">publisher</span><span class="o">.</span><span class="n">journalists</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">journalist</span><span class="p">)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">approved_article</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Approved Story&quot;</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="s2">&quot;Content&quot;</span><span class="p">,</span>
            <span class="n">author</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">journalist</span><span class="p">,</span>
            <span class="n">publisher</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">publisher</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">Article</span><span class="o">.</span><span class="n">STATUS_APPROVED</span>
        <span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">pending_article</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Pending Story&quot;</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="s2">&quot;Draft&quot;</span><span class="p">,</span>
            <span class="n">author</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">journalist</span><span class="p">,</span>
            <span class="n">publisher</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">publisher</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">Article</span><span class="o">.</span><span class="n">STATUS_PENDING</span>
        <span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">newsletter</span> <span class="o">=</span> <span class="n">Newsletter</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Signal Trigger Test&quot;</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="s2">&quot;This newsletter content should fire signals when approved.&quot;</span><span class="p">,</span>
            <span class="n">author</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">journalist</span><span class="p">,</span>
            <span class="n">publisher</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">publisher</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">Newsletter</span><span class="o">.</span><span class="n">STATUS_PENDING</span>
        <span class="p">)</span>

        <span class="c1"># Subscriptions</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">subscriptions_journalists</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">journalist</span><span class="p">)</span></div>


<div class="viewcode-block" id="NewsApiTests.setUp">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests.setUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">client_class</span><span class="p">()</span>

        <span class="c1"># Generate tokens for tests</span>
        <span class="k">for</span> <span class="n">user</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="s2">&quot;reader_token&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">journalist</span><span class="p">,</span> <span class="s2">&quot;journalist_token&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="s2">&quot;editor_token&quot;</span><span class="p">),</span>
        <span class="p">]:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;api:token-auth&#39;</span><span class="p">),</span>
                <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;pass1234&#39;</span><span class="p">},</span>
                <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">_auth&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Token </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="NewsApiTests.test_unauthenticated_cannot_access">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests.test_unauthenticated_cannot_access">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_unauthenticated_cannot_access</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;articles&#39;</span><span class="p">,</span> <span class="s1">&#39;publishers&#39;</span><span class="p">,</span> <span class="s1">&#39;journalists&#39;</span><span class="p">]:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;api:</span><span class="si">{</span><span class="n">ep</span><span class="si">}</span><span class="s1">-list&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_401_UNAUTHORIZED</span><span class="p">)</span></div>


<div class="viewcode-block" id="NewsApiTests.test_publishers_list">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests.test_publishers_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_publishers_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">credentials</span><span class="p">(</span><span class="n">HTTP_AUTHORIZATION</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reader_token_auth</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;api:publishers-list&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="s2">&quot;Daily News&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="NewsApiTests.test_journalists_list">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests.test_journalists_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_journalists_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">credentials</span><span class="p">(</span><span class="n">HTTP_AUTHORIZATION</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reader_token_auth</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;api:journalists-list&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="s2">&quot;journalist1&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="NewsApiTests.test_articles_filtered_by_subscription">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests.test_articles_filtered_by_subscription">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_articles_filtered_by_subscription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">credentials</span><span class="p">(</span><span class="n">HTTP_AUTHORIZATION</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reader_token_auth</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;api:articles-list&#39;</span><span class="p">))</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;Approved Story&quot;</span><span class="p">,</span> <span class="n">titles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s2">&quot;Pending Story&quot;</span><span class="p">,</span> <span class="n">titles</span><span class="p">)</span></div>


<div class="viewcode-block" id="NewsApiTests.test_articles_no_subscription">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests.test_articles_no_subscription">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_articles_no_subscription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">subscriptions_journalists</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">credentials</span><span class="p">(</span><span class="n">HTTP_AUTHORIZATION</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reader_token_auth</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;api:articles-list&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="NewsApiTests.test_retrieve_single_article">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests.test_retrieve_single_article">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_retrieve_single_article</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">credentials</span><span class="p">(</span><span class="n">HTTP_AUTHORIZATION</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reader_token_auth</span><span class="p">)</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;api:articles-detail&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">approved_article</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ok</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>

        <span class="n">nf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;api:articles-detail&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_article</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nf</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">)</span></div>


<div class="viewcode-block" id="NewsApiTests.test_token_invalid_credentials">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests.test_token_invalid_credentials">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_token_invalid_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;api:token-auth&#39;</span><span class="p">),</span>
            <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;reader1&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;wrongpass&#39;</span><span class="p">},</span>
            <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;non_field_errors&#39;</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>


<div class="viewcode-block" id="NewsApiTests.test_journalist_can_create_article">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests.test_journalist_can_create_article">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_journalist_can_create_article</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">credentials</span><span class="p">(</span><span class="n">HTTP_AUTHORIZATION</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">journalist_token_auth</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;api:articles-list&#39;</span><span class="p">),</span>
            <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Breaking&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="o">.</span><span class="n">pk</span><span class="p">},</span>
            <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">],</span> <span class="n">Article</span><span class="o">.</span><span class="n">STATUS_PENDING</span><span class="p">)</span></div>


<div class="viewcode-block" id="NewsApiTests.test_reader_cannot_create_article">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests.test_reader_cannot_create_article">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_reader_cannot_create_article</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">credentials</span><span class="p">(</span><span class="n">HTTP_AUTHORIZATION</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reader_token_auth</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;api:articles-list&#39;</span><span class="p">),</span>
            <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">},</span>
            <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">)</span></div>


<div class="viewcode-block" id="NewsApiTests.test_author_can_update_article">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests.test_author_can_update_article">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_author_can_update_article</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">credentials</span><span class="p">(</span><span class="n">HTTP_AUTHORIZATION</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">journalist_token_auth</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
            <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;api:articles-detail&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">approved_article</span><span class="o">.</span><span class="n">pk</span><span class="p">]),</span>
            <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;New Title&#39;</span><span class="p">},</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="s1">&#39;New Title&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="NewsApiTests.test_non_author_cannot_update_article">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests.test_non_author_cannot_update_article">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_non_author_cannot_update_article</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s2">&quot;other&quot;</span><span class="p">,</span> <span class="s2">&quot;o@x.com&quot;</span><span class="p">,</span> <span class="s2">&quot;pw&quot;</span><span class="p">)</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">Token</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">credentials</span><span class="p">(</span><span class="n">HTTP_AUTHORIZATION</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Token </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
            <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;api:articles-detail&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">approved_article</span><span class="o">.</span><span class="n">pk</span><span class="p">]),</span>
            <span class="p">{</span><span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">},</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">)</span></div>


<div class="viewcode-block" id="NewsApiTests.test_author_can_delete_article">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests.test_author_can_delete_article">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_author_can_delete_article</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">credentials</span><span class="p">(</span><span class="n">HTTP_AUTHORIZATION</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">journalist_token_auth</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;api:articles-detail&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">approved_article</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span></div>


<div class="viewcode-block" id="NewsApiTests.test_editor_approves_article_sends_notifications">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.NewsApiTests.test_editor_approves_article_sends_notifications">[docs]</a>
    <span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;news.api.signals.requests.post&#39;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_editor_approves_article_sends_notifications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_x_post</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">subscriptions_journalists</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">journalist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">credentials</span><span class="p">(</span><span class="n">HTTP_AUTHORIZATION</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">editor_token_auth</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
            <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;api:articles-detail&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_article</span><span class="o">.</span><span class="n">pk</span><span class="p">]),</span>
            <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">Article</span><span class="o">.</span><span class="n">STATUS_APPROVED</span><span class="p">},</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pending_article</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_article</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">Article</span><span class="o">.</span><span class="n">STATUS_APPROVED</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreaterEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">mock_x_post</span><span class="o">.</span><span class="n">assert_called</span><span class="p">()</span></div>
</div>



<span class="c1"># ─── FORM TESTS ────────────────────────────────────────────────────────────</span>

<div class="viewcode-block" id="SubscriptionFormTests">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SubscriptionFormTests">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SubscriptionFormTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for SubscriptionForm validation &amp; saving.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="SubscriptionFormTests.setUp">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SubscriptionFormTests.setUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">CustomUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span>
            <span class="s2">&quot;u1&quot;</span><span class="p">,</span> <span class="s2">&quot;u1@x.com&quot;</span><span class="p">,</span> <span class="s2">&quot;pass1234&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">CustomUser</span><span class="o">.</span><span class="n">ROLE_READER</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">j1</span> <span class="o">=</span> <span class="n">CustomUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span>
            <span class="s2">&quot;j1&quot;</span><span class="p">,</span> <span class="s2">&quot;j1@x.com&quot;</span><span class="p">,</span> <span class="s2">&quot;pass1234&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">CustomUser</span><span class="o">.</span><span class="n">ROLE_JOURNALIST</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">j2</span> <span class="o">=</span> <span class="n">CustomUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span>
            <span class="s2">&quot;j2&quot;</span><span class="p">,</span> <span class="s2">&quot;j2@x.com&quot;</span><span class="p">,</span> <span class="s2">&quot;pass1234&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">CustomUser</span><span class="o">.</span><span class="n">ROLE_JOURNALIST</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub1</span> <span class="o">=</span> <span class="n">Publisher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Pub One&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;D1&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="SubscriptionFormTests.test_empty_submission_is_valid">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SubscriptionFormTests.test_empty_submission_is_valid">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_empty_submission_is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">SubscriptionForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span></div>


<div class="viewcode-block" id="SubscriptionFormTests.test_valid_selection_saves_correctly">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SubscriptionFormTests.test_valid_selection_saves_correctly">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_valid_selection_saves_correctly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">SubscriptionForm</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;subscriptions_journalists&#39;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">j1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j2</span><span class="o">.</span><span class="n">pk</span><span class="p">],</span>
                <span class="s1">&#39;subscriptions_publishers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pub1</span><span class="o">.</span><span class="n">pk</span><span class="p">],</span>
            <span class="p">},</span>
            <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerySetEqual</span><span class="p">(</span>
            <span class="n">u</span><span class="o">.</span><span class="n">subscriptions_journalists</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;pk&#39;</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">j1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j2</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerySetEqual</span><span class="p">(</span>
            <span class="n">u</span><span class="o">.</span><span class="n">subscriptions_publishers</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;pk&#39;</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pub1</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="SubscriptionFormTests.test_invalid_journalist_pk_raises_error">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SubscriptionFormTests.test_invalid_journalist_pk_raises_error">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_invalid_journalist_pk_raises_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">SubscriptionForm</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;subscriptions_journalists&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">999</span><span class="p">]},</span>
            <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;subscriptions_journalists&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="CustomUserCreationFormTests">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.CustomUserCreationFormTests">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CustomUserCreationFormTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for CustomUserCreationForm validation.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="CustomUserCreationFormTests.test_requires_fields">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.CustomUserCreationFormTests.test_requires_fields">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_requires_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CustomUserCreationForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">fld</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span><span class="p">,</span> <span class="s1">&#39;password1&#39;</span><span class="p">,</span> <span class="s1">&#39;password2&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span></div>


<div class="viewcode-block" id="CustomUserCreationFormTests.test_password_mismatch">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.CustomUserCreationFormTests.test_password_mismatch">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_password_mismatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CustomUserCreationForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;u1&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;u1@x.com&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span><span class="p">:</span> <span class="s1">&#39;reader&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password1&#39;</span><span class="p">:</span> <span class="s1">&#39;abc&#39;</span><span class="p">,</span> <span class="s1">&#39;password2&#39;</span><span class="p">:</span> <span class="s1">&#39;xyz&#39;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;password2&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span></div>


<div class="viewcode-block" id="CustomUserCreationFormTests.test_valid_data_creates_user">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.CustomUserCreationFormTests.test_valid_data_creates_user">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_valid_data_creates_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;u2&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;u2@x.com&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span><span class="p">:</span> <span class="s1">&#39;journalist&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password1&#39;</span><span class="p">:</span> <span class="s1">&#39;strong123&#39;</span><span class="p">,</span> <span class="s1">&#39;password2&#39;</span><span class="p">:</span> <span class="s1">&#39;strong123&#39;</span>
        <span class="p">}</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CustomUserCreationForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">check_password</span><span class="p">(</span><span class="s1">&#39;strong123&#39;</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="ArticleFormTests">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleFormTests">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ArticleFormTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for ArticleForm queryset restriction and validation.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="ArticleFormTests.setUp">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleFormTests.setUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">CustomUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span>
            <span class="s2">&quot;journ&quot;</span><span class="p">,</span> <span class="s2">&quot;j@x.com&quot;</span><span class="p">,</span> <span class="s2">&quot;pass1234&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">CustomUser</span><span class="o">.</span><span class="n">ROLE_JOURNALIST</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">CustomUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span>
            <span class="s2">&quot;edit&quot;</span><span class="p">,</span> <span class="s2">&quot;e@x.com&quot;</span><span class="p">,</span> <span class="s2">&quot;pass1234&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">CustomUser</span><span class="o">.</span><span class="n">ROLE_EDITOR</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span> <span class="o">=</span> <span class="n">Publisher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;P1&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;D1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span> <span class="o">=</span> <span class="n">Publisher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;P2&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;D2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">journalists</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">)</span></div>


<div class="viewcode-block" id="ArticleFormTests.test_journalist_only_sees_their_publishers">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleFormTests.test_journalist_only_sees_their_publishers">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_journalist_only_sees_their_publishers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerySetEqual</span><span class="p">(</span>
            <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;publisher&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span><span class="p">,</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ArticleFormTests.test_editor_sees_all_publishers">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleFormTests.test_editor_sees_all_publishers">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_editor_sees_all_publishers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerySetEqual</span><span class="p">(</span>
            <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;publisher&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;pk&#39;</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">],</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ArticleFormTests.test_missing_title_or_body_invalid">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleFormTests.test_missing_title_or_body_invalid">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_missing_title_or_body_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">pk</span><span class="p">},</span> <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">f1</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>

        <span class="n">f2</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">pk</span><span class="p">},</span> <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">f2</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="n">f2</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span></div>
</div>



<span class="c1"># ─── MODEL TESTS ────────────────────────────────────────────────────────────</span>

<div class="viewcode-block" id="ModelTests">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ModelTests">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ModelTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for model methods &amp; properties.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="ModelTests.test_article_get_status_display">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ModelTests.test_article_get_status_display">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_article_get_status_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">Article</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">Article</span><span class="o">.</span><span class="n">STATUS_PENDING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_status_display</span><span class="p">(),</span> <span class="s1">&#39;Pending review&#39;</span><span class="p">)</span></div>
</div>



<span class="c1"># ─── ORM SIGNAL TESTS ───────────────────────────────────────────────────────</span>

<div class="viewcode-block" id="SignalsORMTests">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SignalsORMTests">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SignalsORMTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drive news/signals.py e-mail paths and skip tweet:</span>
<span class="sd">      - Article no-subs → no email</span>
<span class="sd">      - Article journalist/pub subs → email</span>
<span class="sd">      - send_mail exception is caught</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="SignalsORMTests.setUp">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SignalsORMTests.setUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">juser</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span>
            <span class="s2">&quot;juser&quot;</span><span class="p">,</span> <span class="s2">&quot;j@x.com&quot;</span><span class="p">,</span> <span class="s2">&quot;pw&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">User</span><span class="o">.</span><span class="n">ROLE_JOURNALIST</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub</span> <span class="o">=</span> <span class="n">Publisher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Daily&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Desc&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">journalists</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">juser</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">r1</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span>
            <span class="s2">&quot;r1&quot;</span><span class="p">,</span> <span class="s2">&quot;r1@x.com&quot;</span><span class="p">,</span> <span class="s2">&quot;pw&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">User</span><span class="o">.</span><span class="n">ROLE_READER</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r2</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span>
            <span class="s2">&quot;r2&quot;</span><span class="p">,</span> <span class="s2">&quot;r2@x.com&quot;</span><span class="p">,</span> <span class="s2">&quot;pw&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">User</span><span class="o">.</span><span class="n">ROLE_READER</span>
        <span class="p">)</span>

        <span class="c1"># Newsletter object for signal tests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newsletter</span> <span class="o">=</span> <span class="n">Newsletter</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Signal Trigger Test&quot;</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="s2">&quot;This newsletter should fire signals when approved.&quot;</span><span class="p">,</span>
            <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">juser</span><span class="p">,</span>
            <span class="n">publisher</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pub</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">Newsletter</span><span class="o">.</span><span class="n">STATUS_PENDING</span>
        <span class="p">)</span>

        <span class="c1"># Convenience access for creation test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">juser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub</span></div>


<div class="viewcode-block" id="SignalsORMTests.test_article_no_subscribers_no_email">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SignalsORMTests.test_article_no_subscribers_no_email">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_article_no_subscribers_no_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">art</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Lonely&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s2">&quot;Nobody&quot;</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">juser</span><span class="p">,</span>
            <span class="n">publisher</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pub</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">Article</span><span class="o">.</span><span class="n">STATUS_PENDING</span>
        <span class="p">)</span>
        <span class="n">art</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">STATUS_APPROVED</span>
        <span class="n">art</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="SignalsORMTests.test_article_journalist_subscription_sends_email">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SignalsORMTests.test_article_journalist_subscription_sends_email">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_article_journalist_subscription_sends_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r1</span><span class="o">.</span><span class="n">subscriptions_journalists</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">juser</span><span class="p">)</span>
        <span class="n">art</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;ByJ&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s2">&quot;Text&quot;</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">juser</span><span class="p">,</span>
            <span class="n">publisher</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pub</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">Article</span><span class="o">.</span><span class="n">STATUS_PENDING</span>
        <span class="p">)</span>
        <span class="n">art</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">STATUS_APPROVED</span>
        <span class="n">art</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;ByJ&quot;</span><span class="p">,</span> <span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span></div>


<div class="viewcode-block" id="SignalsORMTests.test_article_publisher_subscription_sends_email">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SignalsORMTests.test_article_publisher_subscription_sends_email">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_article_publisher_subscription_sends_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r2</span><span class="o">.</span><span class="n">subscriptions_publishers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pub</span><span class="p">)</span>
        <span class="n">art</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;ByP&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s2">&quot;Text&quot;</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">juser</span><span class="p">,</span>
            <span class="n">publisher</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pub</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">Article</span><span class="o">.</span><span class="n">STATUS_PENDING</span>
        <span class="p">)</span>
        <span class="n">art</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">STATUS_APPROVED</span> 
        <span class="n">art</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreaterEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="s2">&quot;ByP&quot;</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">subject</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">))</span></div>


<div class="viewcode-block" id="SignalsORMTests.test_send_mail_exception_caught">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SignalsORMTests.test_send_mail_exception_caught">[docs]</a>
    <span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;django.core.mail.send_mail&#39;</span><span class="p">,</span> <span class="n">side_effect</span><span class="o">=</span><span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;SMTP fail&quot;</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_send_mail_exception_caught</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_send</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r1</span><span class="o">.</span><span class="n">subscriptions_journalists</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">juser</span><span class="p">)</span>
        <span class="n">art</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Err&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s2">&quot;Boom&quot;</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">juser</span><span class="p">,</span>
            <span class="n">publisher</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pub</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">Article</span><span class="o">.</span><span class="n">STATUS_PENDING</span>
        <span class="p">)</span>
        <span class="n">art</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">STATUS_APPROVED</span>
        <span class="c1"># no exception should escape</span>
        <span class="n">art</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">art</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">Article</span><span class="o">.</span><span class="n">STATUS_APPROVED</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="SignalsORMTests.test_newsletter_approval_triggers_email_and_x_simulation">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SignalsORMTests.test_newsletter_approval_triggers_email_and_x_simulation">[docs]</a>
    <span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;news.signals.send_mass_mail&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_newsletter_approval_triggers_email_and_x_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_mail</span><span class="p">):</span>
        <span class="c1"># Approve the newsletter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newsletter</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">Newsletter</span><span class="o">.</span><span class="n">STATUS_APPROVED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r1</span><span class="o">.</span><span class="n">subscriptions_publishers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newsletter</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">mock_mail</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mock_mail</span><span class="o">.</span><span class="n">call_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreaterEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="SignalsORMTests.test_newsletter_email_error_is_caught">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SignalsORMTests.test_newsletter_email_error_is_caught">[docs]</a>
    <span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;news.signals.send_mass_mail&quot;</span><span class="p">,</span> <span class="n">side_effect</span><span class="o">=</span><span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Newsletter Fail&quot;</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_newsletter_email_error_is_caught</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_mail</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newsletter</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">Newsletter</span><span class="o">.</span><span class="n">STATUS_APPROVED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newsletter</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>

    <span class="c1"># Confirms no exception escapes — error is printed, not raised</span>

<div class="viewcode-block" id="SignalsORMTests.test_newsletter_x_simulation_skips_if_token_absent">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SignalsORMTests.test_newsletter_x_simulation_skips_if_token_absent">[docs]</a>
    <span class="nd">@override_settings</span><span class="p">(</span><span class="n">X_API_BEARER_TOKEN</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;news.signals.send_mass_mail&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_newsletter_x_simulation_skips_if_token_absent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_mail</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newsletter</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">Newsletter</span><span class="o">.</span><span class="n">STATUS_APPROVED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newsletter</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>

    <span class="c1"># Ensures &quot;[X SIMULATION] No X_API_BEARER_TOKEN&quot; path is covered</span>

<div class="viewcode-block" id="SignalsORMTests.test_newsletter_no_signal_on_creation">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SignalsORMTests.test_newsletter_no_signal_on_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_newsletter_no_signal_on_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Create a newsletter directly as approved — signals should not fire</span>
        <span class="n">Newsletter</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Fresh Approved&quot;</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="s2">&quot;Body of newsletter&quot;</span><span class="p">,</span>
            <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="p">,</span>
            <span class="n">publisher</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">Newsletter</span><span class="o">.</span><span class="n">STATUS_APPROVED</span>
        <span class="p">)</span></div>

    <span class="c1"># This bypasses post-save logic since it’s treated as &#39;created=True&#39;</span>

<div class="viewcode-block" id="SignalsORMTests.test_newsletter_signal_skips_if_already_approved">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.SignalsORMTests.test_newsletter_signal_skips_if_already_approved">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_newsletter_signal_skips_if_already_approved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newsletter</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">Newsletter</span><span class="o">.</span><span class="n">STATUS_APPROVED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newsletter</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="c1"># First transition triggers signal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newsletter</span><span class="o">.</span><span class="n">body</span> <span class="o">+=</span> <span class="s2">&quot; extra&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newsletter</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>
</div>

        <span class="c1"># Second save with same status should not re-trigger</span>


<span class="c1"># ─── VIEW TESTS ────────────────────────────────────────────────────────────</span>

<div class="viewcode-block" id="ArticleViewsTests">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleViewsTests">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ArticleViewsTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Full CRUD view coverage for news/views.py.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="ArticleViewsTests.setUp">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleViewsTests.setUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>

        <span class="c1"># Users</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;pass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;pass&#39;</span><span class="p">)</span>

        <span class="c1"># Publisher</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span> <span class="o">=</span> <span class="n">Publisher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Test Pub&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Desc&quot;</span><span class="p">)</span>

        <span class="c1"># Articles (must include publisher)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">articles</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Title </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">body</span><span class="o">=</span><span class="s2">&quot;Body content.&quot;</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="p">,</span>
                <span class="n">publisher</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="p">,</span>
                <span class="n">status</span><span class="o">=</span><span class="n">Article</span><span class="o">.</span><span class="n">STATUS_APPROVED</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># URLs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;news:article-list&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detail_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;news:article-detail&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;news:article-create&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;news:article-update&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;news:article-delete&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span></div>


<div class="viewcode-block" id="ArticleViewsTests.test_list_view">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleViewsTests.test_list_view">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_list_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s1">&#39;news/article_list.html&#39;</span><span class="p">)</span>

        <span class="n">qs</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;object_list&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">qs</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="p">))</span></div>


<div class="viewcode-block" id="ArticleViewsTests.test_detail_view">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleViewsTests.test_detail_view">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_detail_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">detail_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s1">&#39;news/article_detail.html&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;article&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="ArticleViewsTests.test_detail_404">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleViewsTests.test_detail_404">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_detail_404</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bad</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;news:article-detail&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">9999</span><span class="p">])</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bad</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">404</span><span class="p">)</span></div>


<div class="viewcode-block" id="ArticleViewsTests.test_create_requires_login">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleViewsTests.test_create_requires_login">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_create_requires_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>

        <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;Location&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="n">parsed</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">parsed</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">create_url</span><span class="p">])</span></div>


<div class="viewcode-block" id="ArticleViewsTests.test_create_get_and_post">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleViewsTests.test_create_get_and_post">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_create_get_and_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;pass&#39;</span><span class="p">)</span>

        <span class="n">resp_get</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp_get</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">resp_get</span><span class="p">,</span> <span class="s1">&#39;news/article_create.html&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;New Article&#39;</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;XYZ content.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;publisher&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="o">.</span><span class="n">pk</span>
        <span class="p">}</span>
        <span class="n">resp_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">resp_post</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_url</span><span class="p">)</span>

        <span class="n">new</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;New Article&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">author</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">publisher</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="p">)</span></div>


<div class="viewcode-block" id="ArticleViewsTests.test_create_invalid">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleViewsTests.test_create_invalid">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_create_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;pass&#39;</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_url</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">context_data</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;publisher&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span></div>


<div class="viewcode-block" id="ArticleViewsTests.test_update_requires_login">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleViewsTests.test_update_requires_login">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_update_requires_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>

        <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;Location&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="n">parsed</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">parsed</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">update_url</span><span class="p">])</span></div>


<div class="viewcode-block" id="ArticleViewsTests.test_update_get_and_post">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleViewsTests.test_update_get_and_post">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_update_get_and_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;pass&#39;</span><span class="p">)</span>

        <span class="n">resp_get</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp_get</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">resp_get</span><span class="p">,</span> <span class="s1">&#39;news/article_form.html&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Updated Title&#39;</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;New body.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;publisher&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="o">.</span><span class="n">pk</span>
        <span class="p">}</span>
        <span class="n">resp_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span>
            <span class="n">resp_post</span><span class="p">,</span>
            <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;news:article-detail&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="n">updated</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">updated</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s1">&#39;Updated Title&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ArticleViewsTests.test_update_invalid">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleViewsTests.test_update_invalid">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_update_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;pass&#39;</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_url</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">context_data</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;publisher&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span></div>


<div class="viewcode-block" id="ArticleViewsTests.test_delete_requires_login">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleViewsTests.test_delete_requires_login">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_delete_requires_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>

        <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;Location&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="n">parsed</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">parsed</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_url</span><span class="p">])</span></div>


<div class="viewcode-block" id="ArticleViewsTests.test_delete_post">
<a class="viewcode-back" href="../../../../news.api.tests.html#news.api.tests.test_api.ArticleViewsTests.test_delete_post">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_delete_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;pass&#39;</span><span class="p">)</span>
        <span class="n">before</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_url</span><span class="p">)</span>
        <span class="n">after</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">after</span><span class="p">,</span> <span class="n">before</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_url</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>